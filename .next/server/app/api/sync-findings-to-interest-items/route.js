"use strict";(()=>{var e={};e.id=504,e.ids=[504],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6066:(e,t,s)=>{s.r(t),s.d(t,{headerHooks:()=>f,originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>h});var r={};s.r(r),s.d(r,{POST:()=>d,dynamic:()=>l});var i=s(884),n=s(6132),a=s(1040),o=s(5798);let l="force-dynamic";async function d(e){try{let t=await e.json(),{patientId:s,findings:r,patientName:i}=t;if(!s||!r||!Array.isArray(r))return o.Z.json({error:"Patient ID and findings array are required"},{status:400});let n=process.env.AIRTABLE_API_KEY;if(!n)return o.Z.json({error:"Airtable API key not configured"},{status:500});let a=await fetch(`https://api.airtable.com/v0/appXblSpAMBQskgzB/Patients?filterByFormula=%7BRECORD%20ID%7D%3D%27${s}%27&maxRecords=1`,{headers:{Authorization:`Bearer ${n}`}});if(!a.ok)return o.Z.json({error:"Failed to find patient record"},{status:404});let l=await a.json();if(0===l.records.length)return o.Z.json({error:"Patient not found"},{status:404});let d=l.records[0],p=d.id,c=await fetch(`https://api.airtable.com/v0/appXblSpAMBQskgzB/Interest%20Items?filterByFormula=%7BPATIENT%20RECORD%20ID%7D%3D%27${s}%27`,{headers:{Authorization:`Bearer ${n}`}}),u=[];if(c.ok){let e=await c.json();u=e.records.map(e=>e.fields["Interest Item Names"]||"").filter(Boolean)}let m=[];for(let e of r){let t="string"==typeof e?e:e.name;if(u.includes(t)){console.log(`Skipping existing item: ${t}`);continue}let s={"Forehead Wrinkles":"Forehead","Brow Asymmetry":"Forehead","Under Eye Dark Circles":"Eyes","Under Eye Hollow":"Eyes","Dorsal Hump":"Nose","Over-Projected":"Nose","Over-Rotated":"Nose","Nasal Tip Too Wide":"Nose","Mid Cheek Flattening":"Cheeks","Thin Lips":"Lips","Dry Lips":"Lips","Retruded Chin":"Jawline","Asymmetric Chin":"Jawline","Ill-Defined Jawline":"Jawline","Prejowl Sulcus":"Jawline","Excess/Submental Fullness":"Jawline","Neck Lines":"Neck","Dark Spots":"Skin","Red Spots":"Skin","Nasolabial Folds":"Skin","Marionette Lines":"Skin",Whiteheads:"Skin"};s[t];let r={fields:{Patients:[p]}};m.push(r)}let f=[];for(let e=0;e<m.length;e+=10)f.push(m.slice(e,e+10));let h=0;for(let e of f){let t=await fetch("https://api.airtable.com/v0/appXblSpAMBQskgzB/Interest%20Items",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({records:e})});if(!t.ok){let e=await t.text();return o.Z.json({error:`Failed to create interest items: ${t.status}`,details:e},{status:t.status})}let s=await t.json();h+=s.records.length}let g=r.map(e=>"string"==typeof e?e:e.name),y=await fetch(`https://api.airtable.com/v0/appXblSpAMBQskgzB/Patients/${p}`,{method:"PATCH",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({fields:{"Name (from Interest Items)":g}})});return y.ok||console.warn("Failed to update patient's interest items field"),o.Z.json({success:!0,message:`Added ${h} new findings to Interest Items (${r.length-h} already existed)`,createdRecords:h,skippedRecords:r.length-h,interestItemNames:r.map(e=>"string"==typeof e?e:e.name)})}catch(e){return console.error("Error syncing findings to interest items:",e),o.Z.json({error:"Failed to sync findings to interest items",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/sync-findings-to-interest-items/route",pathname:"/api/sync-findings-to-interest-items",filename:"route",bundlePath:"app/api/sync-findings-to-interest-items/route"},resolvedPagePath:"/Users/sambrause/Downloads/aesthetics-ai-demo REVERTED/src/app/api/sync-findings-to-interest-items/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:u,serverHooks:m,headerHooks:f,staticGenerationBailout:h}=p,g="/api/sync-findings-to-interest-items/route";function y(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:u})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[271,107],()=>s(6066));module.exports=r})();